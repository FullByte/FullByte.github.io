# GitHub Copilot Instructions - 0xfab1.net

This file provides instructions for GitHub Copilot when working on the 0xfab1.net MkDocs website project.

## Project Overview

**Type**: Static website built with MkDocs Material theme  
**Content**: 500+ markdown files covering tech documentation, tutorials, and personal content  
**Deployment**: GitHub Pages with automated CI/CD  
**Domain**: https://0xfab1.net  

## Project Structure

```
├── docs/                   # All markdown content (EDIT THESE)
│   ├── about/             # Personal and site information
│   ├── tech/              # Technical documentation
│   ├── make/              # Making/building guides
│   └── index.md           # Homepage
├── site/                  # Generated static site (⚠️ NEVER EDIT - AUTO-GENERATED!)
├── overrides/             # MkDocs theme customizations (EDIT THESE)
├── .github/workflows/     # CI/CD automation
├── dockerfile             # Multi-stage Docker build
├── site_manager.py        # Unified build tool
└── mkdocs.yml            # MkDocs configuration
```

## ⚠️ Critical File Structure Rules

**NEVER EDIT FILES IN `site/` DIRECTORY**
- The `site/` folder contains generated HTML output from MkDocs
- All changes will be lost when the site is rebuilt
- Always edit source files in `docs/` or `overrides/` instead

**Edit These Locations:**
- ✅ `docs/` - All markdown content and assets
- ✅ `overrides/` - Theme customizations and templates
- ✅ Root files - Configuration (mkdocs.yml, dockerfile, etc.)

**Never Edit These:**
- ❌ `site/` - Generated HTML (rebuilt every time)
- ❌ `.venv/` - Python virtual environment

## Key Technologies

- **Site Generator**: MkDocs with Material theme
- **Content Format**: Markdown files with front matter
- **Image Processing**: Automated JPG/PNG → WebP conversion
- **Containerization**: Docker with nginx + Let's Encrypt
- **CI/CD**: GitHub Actions for automated builds and deployment

## Development Environment

**Python Environment**: Always use the virtual environment in `.venv/`
```bash
# Windows PowerShell
& ".\.venv\Scripts\Activate.ps1"

# Unix/macOS  
source .venv/bin/activate
```

**Dependencies**: Install with `pip install -r requirements.txt`

## Build System

### Primary Tool: site_manager.py

The project uses a unified build tool (`site_manager.py`) that handles:
- Image optimization (JPG/PNG → WebP conversion)
- Site statistics generation  
- MkDocs building and serving
- Media path validation
- Site testing

### Common Commands

```bash
# Development server
python site_manager.py serve

# Full build (includes image optimization)
python site_manager.py build

# Image optimization only
python site_manager.py optimize --mode all

# Generate site statistics
python site_manager.py stats

# Test built site for issues
python site_manager.py test

# Check media file references
python site_manager.py check

# Clean build artifacts
python site_manager.py clean
```

### Build Options

- `--quiet`: Suppress verbose output (available for build command)
- `--clean`: Clean build (removes previous artifacts)
- `--no-optimize`: Skip image optimization during build
- `--mode`: Image optimization mode (convert, update, cleanup, all)

## Content Guidelines

### File Organization
- Place images in the same directory as the referencing markdown file
- Use `_filename.ext` naming convention for assets
- Keep related content together in logical directory structures

### Image Handling
- **Preferred formats**: WebP (auto-converted), SVG for graphics
- **Automatic processing**: JPG/PNG files are converted to WebP during build
- **Preservation**: Animated GIFs preserved, SVG originals kept alongside WebP
- **References**: Markdown image references are automatically updated to WebP

### Content Structure
```markdown
# Page Title

Brief description or introduction.

## Section Heading

Content with proper markdown formatting.

### Subsection

- Use consistent heading hierarchy
- Include alt text for images: `![Description](image.webp)`
- Use relative paths for internal links
```

## Docker Configuration

### Multi-stage Build
1. **Builder stage**: Python-based, runs image optimization and MkDocs build
2. **Runtime stage**: nginx:alpine with Let's Encrypt integration

### Key Files
- `dockerfile`: Production build configuration
- `entrypoint.sh`: SSL certificate management and nginx startup
- `nginx.conf`: Web server configuration

### Build Commands
```bash
# Local development
docker run --rm -it -p 8000:8000 -v ${PWD}:/docs squidfunk/mkdocs-material

# Production build
docker build -t 0xfab1-site .
docker run -d -p 80:80 -p 443:443 -v letsencrypt:/etc/letsencrypt 0xfab1-site
```

## CI/CD Workflows

### build-0xfab1.yml
- Triggers: Push to main, PRs, manual dispatch
- Process: Install dependencies → Optimize images → Deploy to GitHub Pages
- Key step: `python site_manager.py optimize --mode all --quiet`

### publish-dockerhub.yml  
- Triggers: Push to main, PRs, manual dispatch
- Process: Multi-platform Docker build and push to Docker Hub
- Uses: docker/build-push-action for efficient builds

## Performance Optimizations

### Build Optimizations
- **Image conversion**: 55.2% size reduction (76MB → 34MB)
- **Incremental processing**: Only converts new/modified images
- **Docker caching**: Multi-stage builds with efficient layer caching
- **Plugin management**: Heavy plugins disabled for development speed

### Runtime Optimizations
- **Compression**: Gzip and Brotli in nginx
- **HTTP/2**: Server push for critical resources  
- **Caching**: Browser caching headers
- **CDN**: GitHub Pages CDN distribution

## Configuration Files

### mkdocs.yml
- **Theme**: Material with dark/light mode
- **Features**: Instant navigation, search highlighting, code blocks
- **Plugins**: Search, minify, selective RSS (disabled for speed)
- **Navigation**: Collapsed by default, use_directory_urls: false

### Requirements
- Core: mkdocs, mkdocs-material
- Optimization: pillow (image processing), cairosvg (SVG support)
- Plugins: minify, rss, git-revision-date-localized, htmlproofer

## Development Workflow

### Making Changes
1. **Content updates**: Edit markdown files in `docs/`
2. **New images**: Place in same directory, let build process convert to WebP
3. **Testing**: Run `python site_manager.py serve` for live preview
4. **Validation**: Use `python site_manager.py test` and `python site_manager.py check`

### Before Committing
1. Run image optimization: `python site_manager.py optimize --mode all`
2. Test build: `python site_manager.py build`
3. Check for issues: `python site_manager.py test`
4. Verify media paths: `python site_manager.py check`

### Commit Guidelines
```
<type>: <description>

Types: feat, fix, docs, style, refactor, perf, test, chore
Examples:
- docs: add new ansible tutorial
- feat: improve image optimization pipeline  
- fix: resolve broken audio file paths
```

## Troubleshooting

### Common Issues
- **Build failures**: Check Python environment activation
- **Missing images**: Verify relative paths and file extensions
- **Slow builds**: Use `--no-optimize` for development iterations
- **Docker issues**: Ensure all referenced files exist in build context

### Performance Issues
- **Large repo**: 449+ markdown files, expect 1-2 minute builds
- **Image processing**: Can take time on first run, incremental after
- **Plugin overhead**: Some plugins disabled for development speed

### Debug Commands
```bash
# Check site structure
python site_manager.py stats

# Validate all media references  
python site_manager.py check

# Test built site for broken links
python site_manager.py test

# Clean and rebuild
python site_manager.py clean
python site_manager.py build
```

## Security Considerations

- **Content**: No sensitive data in markdown files or assets
- **Images**: Strip EXIF metadata during WebP conversion
- **Dependencies**: Keep MkDocs and plugins updated
- **SSL/TLS**: Automated certificate management via Let's Encrypt

## Primary AI Assistant Role

**Main Objective**: Content quality assurance through fact-checking, spell-checking, and grammar correction.

### Content Review Priorities

1. **Fact-checking**: Verify technical accuracy, commands, URLs, and references
2. **Spelling**: Identify and correct misspelled words throughout markdown content
3. **Grammar**: Improve sentence structure, punctuation, and readability
4. **Consistency**: Ensure terminology and formatting consistency across documents
5. **Clarity**: Suggest improvements for unclear or ambiguous content

### Quality Assurance Workflow

```bash
# Before reviewing content, activate environment
& ".\.venv\Scripts\Activate.ps1"

# Generate current statistics for context
python site_manager.py stats

# Check for broken links and media references
python site_manager.py check

# Test site after content changes
python site_manager.py test
```

## AI Assistant Guidelines

When working on this project:

### Content Quality (Primary Focus)
1. **Proofread all markdown content** for spelling, grammar, and clarity
2. **Verify technical accuracy** of commands, code snippets, and procedures
3. **Check external links** and references for validity and relevance
4. **Ensure consistent terminology** across all documentation
5. **Improve readability** through better sentence structure and organization

### ⚠️ CRITICAL: File Editing Rules
6. **NEVER edit files in `site/` directory** - it contains auto-generated HTML that gets overwritten
7. **Only edit source files**: `docs/` (content), `overrides/` (templates), root config files
8. **Always verify file location** before editing - ensure it's NOT in the `site/` folder

### Technical Guidelines  
9. **Always activate the Python virtual environment** before running commands
10. **Use site_manager.py** instead of direct mkdocs commands for consistency
11. **Place images in the same directory** as the referencing markdown file
12. **Use relative paths** for all internal references
13. **Test changes locally** before suggesting CI modifications
14. **Consider build performance** when adding new content or features
15. **Follow existing directory structure** and naming conventions
16. **Update statistics** after significant content changes
17. **Validate media paths** when adding or moving files
18. **Use WebP format** for new images when possible

## External References

- **MkDocs Documentation**: https://www.mkdocs.org/
- **Material Theme**: https://squidfunk.github.io/mkdocs-material/
- **GitHub Pages**: https://pages.github.com/
- **Docker Hub**: https://hub.docker.com/r/0xfab1/0xfab1.net
- **Live Site**: https://0xfab1.net